<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>paddle_and_ball</title>
    <style media="screen">
    canvas {
        border: 1px black solid;
    }
    </style>
    <script src="ball.js"></script>
    <script src="paddle.js"></script>
    <script src="game.js"></script>
    <script src="block.js"></script>
    <script src="levels.js"></script>
    <script src="utilities.js"></script>
</head>

<body>
    <canvas id="id-canvas" width="500" height="400"></canvas>
    <hr>
    <input id="id-input-speed" type="range" value="1">
<script>

    var __main = function() {
        window.fps = 60
        window.pause = false

        // in utilies, for debug
        enableDebugMode(true)

    	var game = Game()

		var paddle = Paddle()
    	var ball = Ball()

        window.blocks = game.createBlocks(levels[0])

    	game.registration('a', function() {
    		paddle.moveLeft()
    	})

		game.registration('d', function() {
    		paddle.moveRight()
    	})    	

    	game.registration('b', function() {
    		ball.fire()
    	})

        game.registration('p', function() {
            window.pause = !window.pause
            log(window.pause)
        })

    	game.update = function() {

            if (window.pause){
                return
            }

            ball.move()

            if (ball.collide(paddle)) {
                ball.ySpeed *= -1
            }

            for (var i = blocks.length - 1; i >= 0; i--) {
                if (blocks[i].collide(ball)) {
                    blocks[i].kill()
                    ball.ySpeed *= -1
                }
            }
    	}
		
		// draw the paddle and the ball
		game.draw = function() {
			game.drawImage(paddle)
			game.drawImage(ball)

            for (var i = blocks.length - 1; i >= 0; i--) {
                if (blocks[i].lives >= 1) {
                    game.drawImage(blocks[i])        
                }
            }
		}
    }

    __main()
    
</script>
</body>

</html>